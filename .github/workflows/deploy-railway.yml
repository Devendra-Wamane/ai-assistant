name: ğŸš€ Deploy to Railway

on:
  workflow_dispatch:  # Manual trigger only
    inputs:
      force_deploy:
        description: 'Force deploy even if no changes'
        required: false
        default: false
        type: boolean

jobs:
  deploy-railway:
    name: ğŸš€ Deploy to Railway
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4

    - name: ğŸš‚ Install Railway CLI
      run: |
        curl -fsSL https://railway.app/install.sh | sh
        echo "$HOME/.railway/bin" >> $GITHUB_PATH

    - name: ğŸ”‘ Railway Authentication
      run: railway login --token ${{ secrets.RAILWAY_TOKEN }}
      env:
        RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}

    - name: ğŸš€ Deploy to Railway
      run: |
        echo "ğŸš€ Deploying AI Assistant to Railway..."
        railway up --detach
        
        echo "â³ Waiting for deployment..."
        sleep 30
        
        # Get the deployment URL
        RAILWAY_URL=$(railway status --json | jq -r '.deployments[0].url // "https://your-app.railway.app"')
        echo "ğŸŒ Deployment URL: $RAILWAY_URL"
        
        # Health check
        echo "ğŸ¥ Running health check..."
        curl -f "$RAILWAY_URL/health" || echo "âš ï¸ Health check failed, but deployment may still be starting"
        
        echo "âœ… Railway deployment complete!"
        echo "ğŸ”— Your AI Assistant is live at: $RAILWAY_URL"

    - name: ğŸ“¢ Deployment Success
      if: success()
      run: |
        echo "ğŸ‰ SUCCESS: AI Assistant deployed to Railway!"
        echo "ğŸŒ Live URL: Check Railway dashboard"
        echo "ğŸ“š API Docs: /docs endpoint"
        echo "ğŸ’¬ Chat Interface: Root URL"