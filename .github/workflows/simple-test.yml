name: ðŸ§ª Simple Test Workflow

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Allow manual trigger

jobs:
  basic-test:
    name: ðŸ§ª Basic Test
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v4
    
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'  # FastAPI 0.129.0 requires Python >=3.10
    
    - name: ðŸ“¦ Install basic deps
      run: |
        python -m pip install --upgrade pip
        pip install fastapi==0.129.0 uvicorn==0.24.0 pytest==7.4.3 httpx==0.25.2
    
    - name: ðŸ§ª Quick test
      run: |
        python -c "
        from fastapi import FastAPI
        app = FastAPI()
        print('âœ… FastAPI import successful')
        "
        
        python -c "
        import app
        print('âœ… App module import successful')
        "
    
    - name: ðŸš€ Test server start
      run: |
        timeout 15s uvicorn app:app --host 0.0.0.0 --port 8000 &
        SERVER_PID=$!
        sleep 5
        
        # Quick health check
        curl -f http://localhost:8000/health || (
          echo "âŒ Health check failed"
          kill $SERVER_PID 2>/dev/null || true
          exit 1
        )
        
        echo "âœ… Server test successful"
        kill $SERVER_PID 2>/dev/null || true